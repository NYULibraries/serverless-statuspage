service: serverless-statuspage
provider:
  name: aws
  region: us-east-2
  runtime: nodejs6.10
  role: ${env:LAMBDA_ROLE}
  stage: ${env:STAGE}
  environment:
    STATUSPAGE_API_KEY: ${ssm:STATUSPAGE_API_KEY}
    STAGE: ${env:STAGE}

package:
  include:
    - handler.js
    - sj-config.js

functions:
  status:
    events:
      - http:
          path: status
          method: get
    handler: handler.status
    memorySize: 128

# DISABLED UNTIL REQUESTED PERMISSIONS GRANTED
# # plugin allows for easy cache enabling
# plugins:
#   - serverless-api-stage
#
# # enable caching with serverless-api-stage plugin
# custom:
#   stageSettings:
#     CacheClusterEnabled: true
#     CacheClusterSize: '0.5'
#     MethodSettings:
#       CachingEnabled: true
#       CacheTtlInSeconds: 300

# Configures api caching for query strings
resources:
  Resources:
    ApiGatewayMethodStatusGet:
      Properties:
        RequestParameters:
          method.request.querystring.type: true,
          method.request.querystring.limit: true,
          method.request.querystring.page_id: true,
        Integration:
          RequestParameters:
            integration.request.querystring.type: method.request.querystring.type
            integration.request.querystring.limit: method.request.querystring.limit
            integration.request.querystring.page_id: method.request.querystring.page_id
          CacheNamespace: "serverless-statuspage"
          CacheKeyParameters:
            - method.request.querystring.type
            - method.request.querystring.limit
            - method.request.querystring.page_id
